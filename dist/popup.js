var port=chrome.runtime.connect({name:"POPUP"}),timetable=void 0;port.onMessage.addListener(function(e){"RESPONSE"==e.type&&("GET_TIMETABLE"!=e.action&&"UPDATE_TIMETABLE"!=e.action||(timetable=e.content,console.log("[USTS] New timetable received."),makeCourses()))});var COLORS=["#e74c3c","#d35400","#34495e","#7f8c8d","#d2527f","#89729e","#674172","#4b77be","#5b8930","#407a52","#6c7a89","#666666"];function adjustColor(e,o){var t=!1;"#"==e[0]&&(e=e.slice(1),t=!0);var c=parseInt(e,16),r=(c>>16)+o;255<r?r=255:r<0&&(r=0);var a=(c>>8&255)+o;255<a?a=255:a<0&&(a=0);var s=(255&c)+o;return 255<s?s=255:s<0&&(s=0),(t?"#":"")+(s|a<<8|r<<16).toString(16)}var adjust={background:function(e){return adjustColor(e,100)},border:function(e){return adjustColor(e,50)},text:function(e){return adjustColor(e,-30)}};function getTimetable(){port.postMessage({type:"REQUEST",action:"GET_TIMETABLE"})}function saveTimetable(){port.postMessage({type:"REQUEST",action:"SAVE_TIMETABLE"})}function updateTimetable(){port.postMessage({type:"REQUEST",action:"UPDATE_TIMETABLE"})}function changeColor(e,o){port.postMessage({type:"REQUEST",action:"CHANGE_COLOR",param:{course:e,color:o}})}var selectedCourse=void 0,selectedColor=void 0;function makeCourses(){var e=$("#course-container");e.empty();var o=$("#course-item-template").prop("content");for(course in timetable){var t=$(o).clone(),c=course.slice(0,4)+" "+course.slice(4);e.append(t),(t=$(".course-item:last-child",e)).attr("id",course),t.attr("data-course",course);var r=$(".course-color-dot",t),a=$(".course-label",t);r.css("background-color",timetable[course]),a.text(c)}$(".course-item").click(function(e){selectedCourse=e.target.dataset.course,selectedColor=timetable[selectedCourse],$(".course-item").removeClass("active"),$(e.target).addClass("active"),updateOptionCircle()}),$(".course-item:first-child",e).click()}function updateCourseDots(){$(".course-item.active .course-color-dot").css("background-color",selectedColor)}function updateOptionCircle(){$(".option-color-circle").removeClass("active"),$('.option-color-circle[data-color="${selectedColor}"]').addClass("active")}function makeOptions(){for(var e=$("#option-container"),o=$("#option-item-template").prop("content"),t=0;t<COLORS.length;t++){var c=COLORS[t],r=$(o).clone();e.append(r),(r=$(".option-color-circle:last-child",e)).attr("data-color",c),r.css({backgroundColor:adjust.background(c),borderColor:adjust.border(c),color:adjust.text(c)})}$(".option-color-circle").click(function(e){selectedColor=e.target.dataset.color,changeColor(selectedCourse,selectedColor),updateCourseDots(),updateOptionCircle()})}$(document).ready(function(){getTimetable(),makeOptions(),$("#save-button").click(saveTimetable),$("#reset-button").click(function(){chrome.tabs.reload(),window.close()}),$("#close-button").click(function(){window.close()}),$("#refresh-button").click(function(){updateTimetable()})});